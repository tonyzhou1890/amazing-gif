!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).AMZGif=e()}(this,function(){"use strict";function s(t,s,l,o){return new(l=l||Promise)(function(i,e){function a(t){try{n(o.next(t))}catch(t){e(t)}}function r(t){try{n(o.throw(t))}catch(t){e(t)}}function n(t){var e;t.done?i(t.value):((e=t.value)instanceof l?e:new l(function(t){t(e)})).then(a,r)}n((o=o.apply(t,s||[])).next())})}function c(t){return"function"==typeof t}const g={notReady:"数据未就绪",wrongParam:"参数错误",noGifUrl:"未指定 gif 图片地址",gifEmpty:"gif 不存在",gifDataTypeError:"gif 数据类型错误",notGif:"文件非 gif",noConfigEl:"未指定 img 元素",noImg:"未找到 img 元素",notImg:t=>`元素 ${t} 不是图片`,isRendering:"isRendering",skinError:"皮肤出错",skinContainerIsSmall:"空间不足以显示皮肤",errData:"数据格式错误"};function u(t){let e=1;for(;t>2**e;)e++;return e}function f(t,e,i,a){return((1<<i)-1&a)<<e|t}const e={loop:!0,auto:!1,interactive:!0,skin:"basic",speed:1},i=[.5,1,1.5,2],p=[0,0,0,255];var r=null;try{r=("undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof __non_webpack_require__&&__non_webpack_require__("worker_threads")||"function"==typeof require&&require("worker_threads")).Worker}catch(t){}function t(t,e,i){var e=void 0===e?null:e,t=(i=void 0!==i&&i,Buffer.from(t,"base64").toString(i?"utf16":"utf8")),i=t.indexOf("\n",10)+1,a=t.substring(i)+(e?"//# sourceMappingURL="+e:"");return function(t){return new r(a,Object.assign({},t,{eval:!0}))}}function a(t,e,i){e=void 0===e?null:e,t=function(t,e){var i=atob(t);if(e){for(var a=new Uint8Array(i.length),r=0,n=i.length;r<n;++r)a[r]=i.charCodeAt(r);return String.fromCharCode.apply(null,new Uint16Array(a.buffer))}return i}(t,void 0!==i&&i),i=t.indexOf("\n",10)+1,t=t.substring(i)+(e?"//# sourceMappingURL="+e:""),i=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(i)}var n="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);l=null,o=!(X="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gdyhlLHQsYSl7cmV0dXJuIGU+PnQmKDE8PGEpLTF9ZnVuY3Rpb24gdihlLHQsYSxvKXtyZXR1cm4oKDE8PGEpLTEmbyk8PHR8ZX12YXIgZT17ZGVjb2RlOihlLHQpPT57ZnVuY3Rpb24gYSgpe3JldHVybiBuZXcgQXJyYXkoMioqZSsyKS5maWxsKDApLm1hcCgoZSx0KT0+U3RyaW5nLmZyb21DaGFyQ29kZSh0KSl9bGV0IG89YSgpO3ZhciBuPTIqKmUsbD0yKiplKzE7bGV0IHI9ZSsxLGk9IiIscz0hMDt2YXIgZD10Lmxlbmd0aDtsZXQgaD0wLGY9MCx1PXIsYz0wLGc9IiIsbT0wO2Zvcig7aDxkOyl7Zm9yKHU9cixjPTA7MCE9PXUmJig4LWY+PXU/KGMrPXcodFtoXSxmLHUpPDxyLXUsZis9dSx1PTApOihjKz13KHRbaF0sZiw4LWYpPDxyLXUsdS09OC1mLGY9OCksISg4PT09ZiYmKGgrKyxmPTAsaD49ZCkpKTspO2lmKGM9PT1sKWJyZWFrO2M9PT1uPyhvPWEoKSxyPWUrMSxzPSEwKToodm9pZCAwIT09b1tjXT9zPyhpKz1vW2NdLG09YyxzPSExKTooaSs9b1tjXSxnPW9bY11bMF0sby5wdXNoKG9bbV0rZyksbT1jKToodm9pZCAwPT09b1ttXSYmY29uc29sZS5sb2cobSxpLmxlbmd0aCksZz1vW21dWzBdLGkrPW9bbV0rZyxvLnB1c2gob1ttXStnKSxtPWMpLG8ubGVuZ3RoPj0yKipyJiZyPDEyJiZyKyspfWNvbnN0IHY9bmV3IFVpbnQ4QXJyYXkoaS5sZW5ndGgpO2ZvcihsZXQgZT0wO2U8aS5sZW5ndGg7ZSsrKXZbZV09aS5jaGFyQ29kZUF0KGUpO3JldHVybiB2fSxlbmNvZGU6KG8sYSk9PntmdW5jdGlvbiBuKCl7Y29uc3QgYT1uZXcgTWFwO3JldHVybiBuZXcgQXJyYXkoMioqbykuZmlsbCgwKS5tYXAoKGUsdCk9PnthLnNldChTdHJpbmcuZnJvbUNoYXJDb2RlKHQpLHQpfSksYX1mdW5jdGlvbiBsKGUpe2xldCB0PWQ7aWYodSsyPj1mLmxlbmd0aCl7Y29uc3QgYT1uZXcgVWludDhBcnJheShmLmxlbmd0aCsyNTYpO2Euc2V0KGYpLGY9YX1mb3IoO3Q7KTgtYz49dD8oZlt1XT12KGZbdV0sYyx0LGUpLGMrPXQsdD0wKTooZlt1XT12KGZbdV0sYyw4LWMsZSksZT4+PTgtYyx0LT04LWMsYz04KSw4PT09YyYmKGM9MCx1KyspfWxldCByPW4oKTt2YXIgaT0yKipvLGU9MioqbysxO2xldCBzPTIqKm8rMixkPW8rMSxoPTIqKmQ7bGV0IGY9bmV3IFVpbnQ4QXJyYXkoMjU2KSx1PTAsYz0wLGc9IiIsbT0iIjtsKGkpO2ZvcihsZXQgZT0wLHQ9YS5sZW5ndGg7ZTx0O2UrKyltPVN0cmluZy5mcm9tQ2hhckNvZGUoYVtlXSksci5oYXMoZyttKT9nKz1tOihsKHIuZ2V0KGcpKSw0MDkzPT09cz8obChpKSxyPW4oKSxzPTIqKm8rMixkPW8rMSxoPTIqKmQpOihzPT09aCYmKGQrKyxoPTIqKmQpLHIuc2V0KGcrbSxzKyspKSxnPW0sbT0iIik7ZyYmbChyLmdldChnKSksbChlKTtsZXQgdD1udWxsO3JldHVybiB0PWM/Zi5zbGljZSgwLHUrMSk6Zi5zbGljZSgwLHUpfX07Y2xhc3MgdHtjb25zdHJ1Y3Rvcigpe3RoaXMubWF4Q29sb3I9MjU0LHRoaXMuY29sb3JDb3VudD0wLHRoaXMudHJlZT1uZXcgaSx0aGlzLnRyZWUubGV2ZWw9LTEsdGhpcy5sZXZlbE5vZGVzPW5ldyBBcnJheSg4KS5maWxsKDApLm1hcCgoKT0+W10pfWFkZENvbG9yKGEsbyxuKXtsZXQgbD10aGlzLnRyZWU7Zm9yKGxldCB0PTc7MDw9dDt0LS0pe3ZhciByPSh3KGEsdCwxKTw8MikrKHcobyx0LDEpPDwxKSt3KG4sdCwxKTtsZXQgZT1sLm5vZGVzW3JdO2lmKGV8fChsLm5vZGVzW3JdPW5ldyBpLChlPWwubm9kZXNbcl0pLmxldmVsPTctdCwoZS5wYXJlbnQ9bCkubm9kZXNDb3VudCsrLGUuaWR4SW5MZXZlbE5vZGVzPXRoaXMubGV2ZWxOb2Rlc1tlLmxldmVsXS5sZW5ndGgsdGhpcy5sZXZlbE5vZGVzW2UubGV2ZWxdLnB1c2goZSksNz09PWUubGV2ZWwmJnRoaXMuY29sb3JDb3VudCsrKSxlLmNvdW50KyssZS5yZWRTdW0rPWEsZS5ncmVlblN1bSs9byxlLmJsdWVTdW0rPW4sZS5pc0xlYWYpYnJlYWs7Nz09PWUubGV2ZWwmJihlLmlzTGVhZj0hMCksbD1lfXRoaXMuY29sb3JDb3VudD50aGlzLm1heENvbG9yJiZ0aGlzLnJlZHVjZUNvbG9yKCl9Z2V0Q29sb3IodCxhLG8pe2xldCBuPXRoaXMudHJlZTtjb25zdCBsPVswLDAsMCwwXTtmb3IobGV0IGU9NzswPD1lO2UtLSl7dmFyIHI9KHcodCxlLDEpPDwyKSsodyhhLGUsMSk8PDEpK3cobyxlLDEpLHI9bi5ub2Rlc1tyXTtpZighcilicmVhaztpZihyLmlzTGVhZil7bFswXT1yLnJlZFN1bS9yLmNvdW50Pj4wLGxbMV09ci5ncmVlblN1bS9yLmNvdW50Pj4wLGxbMl09ci5ibHVlU3VtL3IuY291bnQ+PjAsbFszXT0xO2JyZWFrfW49cn1yZXR1cm4gbH1yZWR1Y2VDb2xvcigpe2xldCBhPW51bGwsbz1OdW1iZXIuTUFYX1NBRkVfSU5URUdFUjtmb3IobGV0IGU9NjswPD1lO2UtLSl7dmFyIG4sbD10aGlzLmxldmVsTm9kZXNbZV07Zm9yKGxldCBlPTAsdD1sLmxlbmd0aDtlPHQ7ZSsrKSFsW2VdfHwhKG49bFtlXSkuaXNMZWFmJiYxPG4ubm9kZXNDb3VudCYmbi5jb3VudDxvJiYoYT1uLG89bi5jb3VudCk7aWYoYSlicmVha31hJiZ0aGlzLmRlbGV0ZVN1Yk5vZGVzKGEpfWRlbGV0ZVN1Yk5vZGVzKGEpe2ZvcihsZXQgZT0wLHQ9YS5ub2Rlcy5sZW5ndGg7ZTx0O2UrKyl7dmFyIG89YS5ub2Rlc1tlXTtvJiYoby5pc0xlYWZ8fHRoaXMuZGVsZXRlU3ViTm9kZXMobyksdGhpcy5sZXZlbE5vZGVzW28ubGV2ZWxdW28uaWR4SW5MZXZlbE5vZGVzXT1udWxsKX10aGlzLmNvbG9yQ291bnQtPWEubm9kZXNDb3VudC0xLGEubm9kZXM9W10sYS5ub2Rlc0NvdW50PTAsYS5pc0xlYWY9ITB9fWNsYXNzIGl7Y29uc3RydWN0b3IoKXt0aGlzLmlzTGVhZj0hMSx0aGlzLmxldmVsPTAsdGhpcy5jb3VudD0wLHRoaXMucmVkU3VtPTAsdGhpcy5ncmVlblN1bT0wLHRoaXMuYmx1ZVN1bT0wLHRoaXMucGFyZW50PW51bGwsdGhpcy5ub2Rlcz1bXSx0aGlzLm5vZGVzQ291bnQ9MCx0aGlzLmlkeEluTGV2ZWxOb2Rlcz0wfX1jb25zdCBvPXtnaWZMendEZWNvZGU6ZS5kZWNvZGUsZ2lmTHp3RW5jb2RlOmUuZW5jb2RlLGNvbG9yVHJhbnNmb3JtOmZ1bmN0aW9uKG8sZT0hMSl7Y29uc3Qgbj17Y29sb3JUYWJsZTpbXSxmcmFtZXM6W119O2lmKG8ubGVuZ3RoKXtjb25zdCBEPW5ldyBNYXAsUz1uZXcgTWFwLHg9bmV3IHQ7bGV0IGE9bnVsbDt2YXIgbCxyLGkscztmb3IobGV0IGU9MCx0PW8ubGVuZ3RoO2U8dDtlKyspe3ZhciBkPW9bZV0uaW1hZ2VEYXRhO2ZvcihsZXQgZT0wLHQ9ZC53aWR0aCpkLmhlaWdodCo0O2U8dDtlKz00KTA9PT1kLmRhdGFbZSszXT9udWxsPT09YSYmKGE9W2QuZGF0YVtlXSxkLmRhdGFbZSsxXSxkLmRhdGFbZSsyXSwwXSk6KFtyLGk9MF09W2QuZGF0YSxlXSxzPXZvaWQgMCxyLmxlbmd0aD49aSs0JiYwPHJbaSszXSYmcltpKzNdPDI1NSYmKHM9cltpKzNdLzI1NSxyW2ldPXJbaV0qcz4+MCxyW2krMV09cltpKzFdKnM+PjAscltpKzJdPXJbaSsyXSpzPj4wLHJbaSszXT0yNTUpLHguYWRkQ29sb3IoZC5kYXRhW2VdLGQuZGF0YVtlKzFdLGQuZGF0YVtlKzJdKSl9Y29uc29sZS5sb2coeCksbD14LmNvbG9yQ291bnQ7Zm9yKGxldCBlPTAsdD1vLmxlbmd0aDtlPHQ7ZSsrKXtjb25zdCBOPW5ldyBJbWFnZURhdGEob1tlXS5pbWFnZURhdGEud2lkdGgsb1tlXS5pbWFnZURhdGEuaGVpZ2h0KSxBPShOLmRhdGEuc2V0KG9bZV0uaW1hZ2VEYXRhLmRhdGEpLG5ldyBVaW50OEFycmF5KE4ud2lkdGgqTi5oZWlnaHQpKTtmb3IobGV0IHQ9MCxhPTAsZT1OLndpZHRoKk4uaGVpZ2h0KjQ7dDxlO3QrPTQsYSsrKWlmKDAhPT1OLmRhdGFbdCszXSl7bGV0IGU9bnVsbDt2YXIgaD1bTi5kYXRhW3RdLE4uZGF0YVt0KzFdLE4uZGF0YVt0KzJdXS5qb2luKCk7RC5oYXMoaCk/ZT1ELmdldChoKTooZT14LmdldENvbG9yKE4uZGF0YVt0XSxOLmRhdGFbdCsxXSxOLmRhdGFbdCsyXSksRC5zZXQoaCxlKSxTLmhhcyhlLmpvaW4oKSl8fChTLnNldChlLmpvaW4oKSxuLmNvbG9yVGFibGUubGVuZ3RoKSxuLmNvbG9yVGFibGUucHVzaChbZVswXSxlWzFdLGVbMl1dKSkpLE4uZGF0YVt0XT1lWzBdLE4uZGF0YVt0KzFdPWVbMV0sTi5kYXRhW3QrMl09ZVsyXSxBW2FdPVMuZ2V0KGUuam9pbigpKX1lbHNlIEFbYV09bDtuLmZyYW1lcy5wdXNoKHtpbWFnZURhdGE6TixpbmRpY2VzOkF9KX1pZihjb25zb2xlLmxvZyhuKSxhPWF8fG4uY29sb3JUYWJsZVtuLmNvbG9yVGFibGUubGVuZ3RoLTFdLG4uY29sb3JUYWJsZS5wdXNoKFthWzBdLGFbMV0sYVsxXV0pLGUpe3ZhciBmPW8sdT1uLGM9UyxnPVtbMSwwLDcvMTZdLFstMSwxLDMvMTZdLFswLDEsNS8xNl0sWzEsMSwxLzE2XV0sbT1uZXcgTWFwO2ZvcihsZXQgZT0wLHQ9Zi5sZW5ndGg7ZTx0O2UrKyl7dmFyIHY9ZltlXS5pbWFnZURhdGE7Y29uc3QgTD11LmZyYW1lc1tlXS5pbWFnZURhdGEsST1uZXcgSW1hZ2VEYXRhKEwud2lkdGgsTC5oZWlnaHQpLE09KEkuZGF0YS5zZXQoTC5kYXRhKSx1LmZyYW1lc1tlXS5pbmRpY2VzKTtmb3IobGV0IHQ9MCxlPXYud2lkdGgqdi5oZWlnaHQqNDt0PGU7dCs9NClpZigwIT09TC5kYXRhW3QrM10pe3ZhciB3PWZ1bmN0aW9uKGUsdCl7cmV0dXJue3g6dC80JWUud2lkdGgseTp0LzQ+PjB9fSh2LHQpO2ZvcihsZXQgZT0wO2U8NDtlKyspe3ZhciBDPWdbZV0scD17eDp3LngrQ1swXSx5OncueStDWzFdfTtpZigwPD1wLngmJnAueDx2LndpZHRoJiYwPD1wLnkmJnAueTx2LmhlaWdodCl7dmFyIGI9ZnVuY3Rpb24oZSx0LGEpe3JldHVybiA0KihhKmUud2lkdGgrdCl9KHYscC54LHAueSk7aWYoMCE9PUwuZGF0YVtiKzNdKWZvcihsZXQgZT0wO2U8MztlKyspe3ZhciB5PXYuZGF0YVt0K2VdLUwuZGF0YVt0K2VdO0wuZGF0YVtiK2VdKz15KkNbMl19fX1jb25zdCBqPWZ1bmN0aW9uKG4sbCxlKXt2YXIgdD1uLmpvaW4oKTt7aWYoZS5oYXModCkpcmV0dXJuIGUuZ2V0KHQpO3t2YXIgcj1bXTtsZXQgYT0xLzAsbz0tMTtmb3IobGV0IGU9MCx0PWwubGVuZ3RoO2U8dDtlKyspe3ZhciBpPWxbZV0scz0oblswXStpWzBdKS8yLGQ9blswXS1pWzBdLGg9blsxXS1pWzFdLGk9blsyXS1pWzJdLGQ9TWF0aC5zcXJ0KCgyK3MvMjU2KSpkKmQrNCpoKmgrKDIrKDI1NS1zKS8yNTYpKmkqaSk7aWYoZDxhJiYoYT1kLG89ZSxhPDEpKWJyZWFrfXJldHVybiByPVsuLi5sW29dLDFdLGUuc2V0KHQscikscn19fShbTC5kYXRhW3RdLEwuZGF0YVt0KzFdLEwuZGF0YVt0KzJdXSx1LmNvbG9yVGFibGUsbSk7TC5kYXRhW3RdPWpbMF0sTC5kYXRhW3QrMV09alsxXSxMLmRhdGFbdCsyXT1qWzJdLE1bdC80Pj4wXT1jLmdldChqLmpvaW4oKSl9Y29uc3QgVD1uZXcgSW1hZ2VEYXRhKEwud2lkdGgsTC5oZWlnaHQpO1QuZGF0YS5zZXQoTC5kYXRhKX19fXJldHVybiBufSxyZXBsYWNlUmVwZXRlZEluZGljZXM6ZnVuY3Rpb24obyl7aWYoIW8uZnJhbWVzLnNvbWUoZT0+ZS5sY3RGbGFnKSl7dmFyIG49by5oZWFkZXIuYmdJbmRleCxsPW8uaGVhZGVyLndpZHRoLGU9by5oZWFkZXIuaGVpZ2h0O2xldCBhPW5ldyBVaW50OEFycmF5KGwqZSkuZmlsbChuKTtmb3IobGV0IGU9MCx0PW8uZnJhbWVzLmxlbmd0aDtlPHQ7ZSsrKXtjb25zdCBkPW8uZnJhbWVzW2VdLGg9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBlPTAsdD1oLmxlbmd0aDtlPHQ7ZSsrKXt2YXIgcj1lJWwsaT1lL2w+PjA7cj49ZC5sZWZ0JiZyPGQubGVmdCtkLndpZHRoJiZpPj1kLnRvcCYmaTxkLnRvcCtkLmhlaWdodCYmKGk9KGktZC50b3ApKmQud2lkdGgrKHItZC5sZWZ0KSxkLnRyYW5zQ29sb3JGbGFnJiZkLmltYWdlRGF0YVtpXSE9PWQudHJhbnNDb2xvcklkeCYmZC5pbWFnZURhdGFbaV0hPT1uJiZkLmltYWdlRGF0YVtpXT09PWhbZV0mJihkLmltYWdlRGF0YVtpXT1kLnRyYW5zQ29sb3JJZHgpLGhbZV09ZC5pbWFnZURhdGFbaV0pfWlmKFswLDFdLmluY2x1ZGVzKGQuZGlzcG9zYWxNZXRob2QpKWE9aDtlbHNlIGlmKDI9PT1kLmRpc3Bvc2FsTWV0aG9kKXtmb3IobGV0IHQ9MDt0PGQuaGVpZ2h0O3QrKylmb3IobGV0IGU9MDtlPGQud2lkdGg7ZSsrKXt2YXIgcz0odCtkLnRvcCkqbCtlK2QubGVmdDtoW3NdPW59YT1ofX19cmV0dXJuIG99fTtvbm1lc3NhZ2U9ZT0+e3ZhcnthY3Rpb246ZSxwYXJhbTp0LF9zaWduOmF9PWUuZGF0YTsiZnVuY3Rpb24iPT10eXBlb2Ygb1tlXT8odD17YWN0aW9uOmUscmVzdWx0Om9bZV0oLi4ubnVsbCE9dD90OltdKSxfc2lnbjphfSxwb3N0TWVzc2FnZSh0KSk6Y29uc29sZS5sb2coYGFjdGlvbiAke2V9IG5vdCBmb3VuZGApfX0oKTsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9d29ya2VyVXRpbHMuanMubWFwCgo=");var l,o,d,h,m,b,y=n?t(X,l,o):(d=X,h=l,m=o,function(t){return b=b||a(d,h,m),new Worker(b,t)}),n=Math.max(window.navigator.hardwareConcurrency-1,1);const Z=new Map,G=[],x=new Array(n).fill(null).map((t,e)=>({index:e,worker:new y,idle:!0}));function L(){let t=null;var e;G.length&&(t=x.find(t=>t.idle))&&(t.idle=!1,e=G.shift(),Z.set(e._sign,e.p),t.worker.postMessage(Object.assign(Object.assign({},e.job),{_sign:e._sign}),e.job.transferable||[]))}x.map(e=>{e.worker.addEventListener("message",t=>{t.data&&t.data._sign?(Z.get(t.data._sign).resolve(t.data.result),Z.delete(t.data._sign),e.idle=!0,L()):(console.error("worker 返回数据错误"),Z.get(t.data._sign).reject("worker 返回数据错误"))})});function w(d,h){return s(this,void 0,void 0,function*(){if(!(d instanceof ArrayBuffer)){if(c(h))return h(g.gifDataTypeError,"onDataError");throw new Error(g.gifDataTypeError)}var t=new Uint8Array(d);const e={ptr:0},i={header:{type:"",isGif:!1,version:"",width:0,height:0,gctFlag:!1,cr:0,sortFlag:!1,gctSize:0,gctStartByte:0,gctEndByte:0,bgIndex:0,pixelAspect:0,gctList:[]},frames:[]};for(var a=window.performance.now();e.ptr<t.length;){if(0===e.ptr){var r=function(e,t){const i={type:"",isGif:!1,version:""};for(let t=0;t<3;t++)i.type+=String.fromCharCode(e[t]);if(i.isGif=i.type==="GIF",i.isGif){for(let t=3;t<6;t++)i.version+=String.fromCharCode(e[t]);t.ptr=5}return i}(t,e);if(!r.isGif)return h(g.notGif,"onDataError");Object.assign(i.header,r)}else if(6===e.ptr){var r=function(t,e){const i={width:0,height:0,gctFlag:!1,cr:0,sortFlag:!1,gctSize:0,gctStartByte:0,gctEndByte:0,bgIndex:0,pixelAspect:0};i.width=t[6]+(t[7]<<8),i.height=t[8]+(t[9]<<8),i.gctFlag=Boolean(t[10]>>7),i.cr=t[10]>>4&7,i.sortFlag=Boolean(8&t[10]),i.gctSize=Math.pow(2,1+(7&t[10])),i.gctFlag&&(i.gctStartByte=13,i.gctEndByte=13+3*i.gctSize-1);return i.bgIndex=t[11],i.pixelAspect=t[12],e.ptr=12,i}(t,e),n=(Object.assign(i.header,r),r.gctFlag?(++e.ptr,function(e,t,i){const a=3*t,r=13+a,n=[];for(let t=13;t<r;t+=3)n.push([e[t],e[t+1],e[t+2]]);return i.ptr=r-1,n}(t,r.gctSize,e)):[]);i.header.gctList=n}else if(e.ptr+1<t.length&&33===t[e.ptr]&&255===t[e.ptr+1]&&!i.appExt){n=function(e,t){const i={appName:"",verification:"",blockIdx:1,repetitionTimes:0,startByte:0,endByte:0};i.startByte=t.ptr;let a=i.startByte;var r=e[a+=2];a++;for(let t=0;t<r-3;t++)i.appName+=String.fromCharCode(e[a+t]);a+=r-3;for(let t=0;t<3;t++)i.verification+=String.fromCharCode(e[a+t]);a+=3;var n=e[a];return i.endByte=a+n,i.blockIdx=e[a+1],i.repetitionTimes=e[a+2]+(e[a+3]<<8),t.ptr=i.endByte,i}(t,e);i.appExt=n}else if(e.ptr+1<t.length&&33===t[e.ptr]&&249===t[e.ptr+1])i.frames.push(M(t,e));else if(44===t[e.ptr]){const o=M(t,e);var s=i.frames[i.frames.length-1];s.endByte?i.frames.push(o):(o.startByte=s.startByte,o.disposalMethod=s.disposalMethod,o.userInputFlag=s.userInputFlag,o.transColorFlag=s.transColorFlag,o.delay=s.delay,o.transColorIdx=s.transColorIdx,i.frames[i.frames.length-1]=o)}else if(e.ptr+1<t.length&&33===t[e.ptr]&&1===t[e.ptr+1])i.frames.push(M(t,e));else if(59===t[e.ptr])break;e.ptr++}console.log("parse: ",window.performance.now()-a),a=window.performance.now();const l=yield Promise.all(i.frames.map(t=>v({action:"gifLzwDecode",param:[t.codeSize,t.imageData],transferable:[t.imageData.buffer]})));return console.log("duration: ",window.performance.now()-a),l.map((t,e)=>{i.frames[e].imageData=t}),i})}var v=a=>new Promise((t,e)=>{var i=Date.now()*Math.random();G.push({_sign:i,job:a,p:{resolve:t,reject:e}}),L()});function M(i,t){const a={startByte:t.ptr,endByte:0,width:0,height:0,left:0,top:0,disposalMethod:0,userInputFlag:!1,transColorFlag:!1,delay:0,transColorIdx:0,lctFlag:!1,interlace:!1,sortFlag:!1,lctSize:0,lctStartByte:0,lctEndByte:0,lctList:[],codeSize:0,imageData:new Uint8Array,imageStartByte:0,imageEndByte:0};if(33===i[t.ptr]&&249===i[t.ptr+1]&&(t.ptr+=2,r=i[t.ptr],r=t.ptr+r+1,t.ptr++,a.disposalMethod=(28&i[t.ptr])>>2,a.userInputFlag=Boolean((2&i[t.ptr])>>1),a.transColorFlag=Boolean(1&i[t.ptr]),a.delay=10*(i[++t.ptr]+(i[++t.ptr]<<8)),a.transColorIdx=i[++t.ptr],(0!==i[++t.ptr]||t.ptr>r)&&(t.ptr=r)),44===i[t.ptr]){if(a.left=i[++t.ptr]+(i[++t.ptr]<<8),a.top=i[++t.ptr]+(i[++t.ptr]<<8),a.width=i[++t.ptr]+(i[++t.ptr]<<8),a.height=i[++t.ptr]+(i[++t.ptr]<<8),a.lctFlag=Boolean(128&i[++t.ptr]),a.interlace=Boolean(64&i[t.ptr]),a.sortFlag=Boolean(32&i[t.ptr]),a.lctSize=Math.pow(2,1+(7&i[t.ptr])),a.lctFlag){a.lctStartByte=t.ptr+1,a.lctEndByte=t.ptr+3*a.lctSize;for(let t=a.lctStartByte;t<a.lctEndByte;t+=3)a.lctList.push([i[t],i[t+1],i[t+2]]);t.ptr=a.lctEndByte}t.ptr++,a.imageStartByte=t.ptr;var r=i[t.ptr++];const l=[];let e=0;for(;0!==i[t.ptr]&&void 0!==i[t.ptr];){var n=i[t.ptr++],s=i.slice(t.ptr,t.ptr+n);e+=s.length,l.push(s),t.ptr+=n}a.imageEndByte=t.ptr,a.endByte=t.ptr;const o=new Uint8Array(e);for(let t=l.length-1;0<=t;t--)o.set(l[t],e-=l[t].length);a.codeSize=r,a.imageData=o}return a}function K(i){var t=performance.now();let a=0,r=t;a=window.requestAnimationFrame(function t(e){1e3/60<=e-r&&(r=e-(e-r)%(1e3/60),i.map(t=>{t(e)})),a=window.requestAnimationFrame(t)})}function C(t,i){const a=t.frames[i];if(a.canvasImageData instanceof ImageData)return a.canvasImageData;var r=function t(i,e){if(e<=0)return;const a=i.frames[e-1];if(0===a.disposalMethod)return;if(2===a.disposalMethod){const r=i.header.gctFlag?[...i.header.gctList[i.header.bgIndex],255]:[...p];let t=a.canvasImageData;t=t||C(i,e-1);const n=new ImageData(t.width,t.height);n.data.set(t.data);for(let e=a.top;e<a.top+a.height;e++)for(let t=a.left;t<a.left+a.width;t++){const s=e*i.header.width+t<<2;n.data[s]=r[0],n.data[1+s]=r[1],n.data[2+s]=r[2],n.data[3+s]=r[3]}return n}if([1].includes(a.disposalMethod))return a.canvasImageData||C(i,e-1);if(3===a.disposalMethod)return t(i,e-1);return}(t,i),n=a.lctFlag?a.lctList:t.header.gctList,s=t.header.gctFlag?[...t.header.gctList[t.header.bgIndex],255]:[...p],l=t.header.width,i=t.header.height,o=S(a);const d=new Uint8ClampedArray(l*i*4);for(let t=0,e=l*i;t<e;t++){var h=t%l,c=t/l>>0,g=t<<2;h>=a.left&&h<a.left+a.width&&c>=a.top&&c<a.top+a.height?(h=h-a.left+(c-a.top)*a.width,a.transColorFlag&&o[h]===a.transColorIdx?r&&(d[g]=r.data[g],d[1+g]=r.data[1+g],d[2+g]=r.data[2+g],d[3+g]=r.data[3+g]):(c=n[o[h]],d[g]=c[0],d[1+g]=c[1],d[2+g]=c[2],d[3+g]=255)):r?(d[g]=r.data[g],d[1+g]=r.data[1+g],d[2+g]=r.data[2+g],d[3+g]=r.data[3+g]):(d[g]=s[0],d[1+g]=s[1],d[2+g]=s[2],d[3+g]=s[3])}t=new ImageData(d,l,i);return a.canvasImageData=t}function W(t,e){const i=t.frames[e];if(i.rawImageData instanceof ImageData)return i.rawImageData;var a=i.lctFlag?i.lctList:t.header.gctList,r=S(i);const n=new Uint8ClampedArray(i.width*i.height*4);for(let t=0;t<i.imageData.length;t++){var s,l=t<<2;i.transColorFlag&&r[t]===i.transColorIdx?(n[l]=0,n[1+l]=0,n[2+l]=0,n[3+l]=0):(s=a[r[t]],n[l]=s[0],n[1+l]=s[1],n[2+l]=s[2],n[3+l]=255)}const o=new ImageData(i.width,i.height);return o.data.set(n),i.rawImageData=o}function S(i){const a=new Uint8Array(i.imageData.length);let r=0;function e(e){for(let t=0;t<i.width;t++)a[r]=i.imageData[e*i.width+t],r++}if(i.interlace){let t=0;for(;t<i.height;)e(t),t+=8;for(t=4;t<i.height;)e(t),t+=8;for(t=2;t<i.height;)e(t),t+=4;for(t=1;t<i.height;)e(t),t+=2}else a.set(i.imageData);return a}class z extends class{constructor(t){this.keys=[],this.watch={},this.amzGif=t,this.cache={},this.init()}init(){this.dirtyChecking()}dirtyChecking(){const e=[];let i;Object.keys(this.watch).map(t=>{i=this.getValue(t),this.cache[t]!==i&&e.push({key:t,oldValue:this.cache[t],newValue:i})}),e.map(t=>s(this,void 0,void 0,function*(){c(this.watch[t.key])&&(yield this.watch[t.key](t.newValue,t.oldValue))}))}getValue(t){var e=t.split(".").filter(t=>t);let i=this.amzGif;for(let t=0;t<e.length&&void 0!==(i=null===i||void 0===i?void 0:i[e[t]]);t++);return i}}{constructor(t){super(t),this.playDiv=null,this.playImg=null,this.loadingDiv=null,this.loadingImg=null,this.loadingImgRoate=0,this.handlePlay=this.handlePlay.bind(this),this.dirtyChecking=this.dirtyChecking.bind(this),this.init(),this.setWatch()}init(){const t=this.amzGif._canvas.parentElement;if(t){var e=t.getBoundingClientRect();const i=this.genMask(e.width,e.height),a=(i.style.zIndex="1",i.style.display="none",i.style.cursor="pointer",i.addEventListener("click",this.handlePlay.bind(this)),this.playDiv=i,document.createElement("img")),r=(a.src="data:image/svg+xml;base64,PHN2ZyB0PSIxNjYyNzg5NjY0NjUyIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIzNjciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48cGF0aCBkPSJNMTI4IDEzOC42NjY2NjdjMC00Ny4yMzIgMzMuMzIyNjY3LTY2LjY2NjY2NyA3NC4xNzYtNDMuNTYyNjY3bDY2My4xNDY2NjcgMzc0Ljk1NDY2N2M0MC45NiAyMy4xNjggNDAuODUzMzMzIDYwLjggMCA4My44ODI2NjZMMjAyLjE3NiA5MjguODk2QzE2MS4yMTYgOTUyLjA2NCAxMjggOTMyLjU2NTMzMyAxMjggODg1LjMzMzMzM3YtNzQ2LjY2NjY2NnoiIGZpbGw9IiMzRDNEM0QiIHAtaWQ9IjIzNjgiPjwvcGF0aD48L3N2Zz4=",a.style.width="60px",a.style.height="60px",a.style.opacity="0.6",this.playImg=a,i.appendChild(a),t.appendChild(i),this.genMask(e.width,e.height)),n=((this.loadingDiv=r).style.zIndex="2",r.style.display="none",document.createElement("img"));(this.loadingImg=n).src="data:image/svg+xml;base64,PHN2ZyB0PSIxNjYyNzg5NzI0Njc4IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM0NDEiIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48cGF0aCBkPSJNNTEyLjUxMSAyMS40ODNjLTI3MS4xNjMgMC00OTEuMDI4IDIxOS44Ni00OTEuMDI4IDQ5MS4wMjggMCAyNzEuMTczIDIxOS44NTYgNDkxLjAzIDQ5MS4wMjggNDkxLjAzIDI2LjU1NCAwIDQ4LjA4LTIxLjUyNyA0OC4wOC00OC4wOCAwLTI2LjU1NC0yMS41MjYtNDguMDgtNDguMDgtNDguMDgtMjE4LjA2NSAwLTM5NC44NjktMTc2LjgwNC0zOTQuODY5LTM5NC44NyAwLTIxOC4wNiAxNzYuODEzLTM5NC44NjkgMzk0Ljg3LTM5NC44NjkgMjE4LjA2NSAwIDM5NC44NjkgMTc2LjgwNCAzOTQuODY5IDM5NC44NyAwIDI2LjU1MyAyMS41MjYgNDguMDggNDguMDggNDguMDggMjYuNTUzIDAgNDguMDgtMjEuNTI3IDQ4LjA4LTQ4LjA4IDAtMjcxLjE3My0yMTkuODU3LTQ5MS4wMy00OTEuMDMtNDkxLjAzeiIgcC1pZD0iMzQ0MiI+PC9wYXRoPjwvc3ZnPg==",n.style.width="60px",n.style.height="60px",n.style.opacity="0.6",r.appendChild(n),t.appendChild(r),this.amzGif._rAFCallbackQueue.push(this.dirtyChecking.bind(this))}else this.amzGif._errCall(g.skinError,"onError")}genMask(t,e){const i=document.createElement("div");return i.style.backgroundColor="rgba(0, 0, 0, 0.3)",i.style.width=t+"px",i.style.height=e+"px",i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.display="flex",i.style.justifyContent="center",i.style.alignItems="center",i}setWatch(){this.watch.isPlaying=t=>{this.playDiv&&(this.playDiv.style.display=t||this.amzGif.isLoading?"none":"flex")},this.watch.isLoading=t=>{this.loadingDiv&&(this.loadingDiv.style.display=t?"flex":"none",t&&this.loadingImg&&(this.loadingImg.style.transform=`rotate(${this.loadingImgRoate+=1}deg)`))}}handlePlay(){this.amzGif.isPlaying||this.amzGif.play()}}function I(n){return s(this,void 0,void 0,function*(){const t={buf:T(new Uint8Array(0)),ptr:0};var e,i;if(i=t,e=n.header,i.buf[0]=e.type.charCodeAt(0),i.buf[1]=e.type.charCodeAt(1),i.buf[2]=e.type.charCodeAt(2),i.buf[3]=e.version.charCodeAt(0),i.buf[4]=e.version.charCodeAt(1),i.buf[5]=e.version.charCodeAt(2),i.ptr=6,e=t,i=n.header,e.buf[6]=255&i.width,e.buf[7]=i.width>>8,e.buf[8]=255&i.height,e.buf[9]=i.height>>8,e.buf[10]=f(e.buf[10],7,1,Number(i.gctFlag)),e.buf[10]=f(e.buf[10],4,3,i.cr-1),e.buf[10]=f(e.buf[10],3,1,Number(i.sortFlag)),e.buf[10]=f(e.buf[10],0,3,u(i.gctSize)-1),e.buf[11]=i.bgIndex,e.buf[12]=i.pixelAspect,e.ptr=13,n.header.gctFlag&&D(t,n.header.gctList),n.appExt){var a=t,r=n.appExt;a.ptr+18>=a.buf.length&&(a.buf=T(a.buf)),a.buf[a.ptr++]=33,a.buf[a.ptr++]=255,a.buf[a.ptr++]=r.appName.length+r.verification.length;for(let t=0,e=r.appName.length;t<e;t++)a.buf[a.ptr++]=r.appName.charCodeAt(t);for(let t=0,e=r.verification.length;t<e;t++)a.buf[a.ptr++]=r.verification.charCodeAt(t);a.buf[a.ptr++]=3,a.buf[a.ptr++]=r.blockIdx,a.buf[a.ptr++]=255&r.repetitionTimes,a.buf[a.ptr++]=r.repetitionTimes>>8,a.buf[a.ptr++]=0}return yield function(h,c,i){return s(this,void 0,void 0,function*(){const a=[];var t=window.performance.now(),r=yield Promise.all(c.map((t,e)=>(a[e]=t.lctFlag?u(t.lctSize):u(i),v({action:"gifLzwEncode",param:[a[e],t.imageData]}))));console.log("encode frames buffer: ",window.performance.now()-t);for(let t=0,e=c.length;t<e;t++){var n=c[t],s=(l=s=void 0,h),l=n,l=(s.ptr+8>=s.buf.length&&(s.buf=T(s.buf)),s.buf[s.ptr++]=33,s.buf[s.ptr++]=249,s.buf[s.ptr++]=4,s.buf[s.ptr]=f(s.buf[s.ptr],2,3,l.disposalMethod),s.buf[s.ptr]=f(s.buf[s.ptr],1,1,Number(l.userInputFlag)),s.buf[s.ptr]=f(s.buf[s.ptr],0,1,Number(l.transColorFlag)),s.ptr++,console.log("encode delay: ",l.delay),s.buf[s.ptr++]=l.delay/10&255,s.buf[s.ptr++]=l.delay/10>>8,s.buf[s.ptr++]=l.transColorIdx,s.buf[s.ptr++]=0,s=l=void 0,h),s=n;l.ptr+10>=l.buf.length&&(l.buf=T(l.buf)),l.buf[l.ptr++]=44,l.buf[l.ptr++]=255&s.left,l.buf[l.ptr++]=s.left>>8,l.buf[l.ptr++]=255&s.top,l.buf[l.ptr++]=s.top>>8,l.buf[l.ptr++]=255&s.width,l.buf[l.ptr++]=s.width>>8,l.buf[l.ptr++]=255&s.height,l.buf[l.ptr++]=s.height>>8,l.buf[l.ptr]=f(l.buf[l.ptr],7,1,Number(s.lctFlag)),l.buf[l.ptr]=f(l.buf[l.ptr],6,1,Number(s.interlace)),l.buf[l.ptr]=f(l.buf[l.ptr],2,1,Number(s.sortFlag)),l.buf[l.ptr]=f(l.buf[l.ptr],0,3,u(s.lctSize)-1),l.ptr++,n.lctFlag&&D(h,n.lctList);for(var o=r[t],d=o.length+Math.ceil(o.length/255);h.ptr+1+d>=h.buf.length;)h.buf=T(h.buf);h.buf[h.ptr++]=a[t];let i=h.ptr;for(let t=0,e=o.length;t<e;t++)i===h.ptr&&h.ptr++,h.buf[h.ptr]=o[t],h.ptr-i!=255&&t+1!==e||(h.buf[i]=h.ptr-i,i=h.ptr+1),h.ptr++;h.buf[h.ptr++]=0}})}(t,n.frames,n.header.gctSize),t.ptr>=t.buf.length&&(t.buf=T(t.buf)),t.buf[t.ptr]=59,t.ptr++,t.buf.slice(0,t.ptr)})}function D(i,a){for(let t=0,e=a.length;t<e;t++)i.ptr+3>=i.buf.length&&(i.buf=T(i.buf)),i.buf[i.ptr++]=a[t][0],i.buf[i.ptr++]=a[t][1],i.buf[i.ptr++]=a[t][2]}function T(t){var e=1048576;if(e=e||256,t instanceof Uint8Array){const i=new Uint8Array(t.length+e);return i.set(t),i}}function Y(t){return"number"==typeof t?Math.max(0,Math.min(t,255)):0}function _(l){return s(this,void 0,void 0,function*(){const a={header:{type:"GIF",isGif:!0,version:"89a",width:0,height:0,gctFlag:!0,cr:7,sortFlag:!1,gctSize:0,gctStartByte:0,gctEndByte:0,bgIndex:0,pixelAspect:1,gctList:[]},appExt:{appName:"NETSCAPE",blockIdx:1,startByte:0,endByte:0,verification:"2.0",repetitionTimes:0},frames:[]};let i;const r=[[]],n=(l.frames.map((t,e)=>{t.setLocalColorTable?r.push([{frameIdx:e,frameData:t}]):r[0].push({frameIdx:e,frameData:t})}),yield Promise.all(r.map(t=>v({action:"colorTransform",param:[t.map(t=>t.frameData),l.dithering]}))));console.log("quantizedFrames: ",n),r.map((t,i)=>{t.map((t,e)=>{a.frames[t.frameIdx]={},a.frames[t.frameIdx].imageData=n[i].frames[e].indices,0===i?a.header.gctList=n[i].colorTable:a.frames[t.frameIdx].lctList=n[i].colorTable})});[...t]=[...l.frames.map(t=>t.imageData)];var t={x:Math.max(...t.map(t=>t.width)),y:Math.max(...t.map(t=>t.height))};a.header.width=t.x,a.header.height=t.y;let e=[0,0,0];l.backgroundColor&&(e=function(t){const e=new Array(4).fill(0),i=(e[3]=1,t.replace(/ /g,""));if(i)if(i.startsWith("#")){t=parseInt(i.substring(1),16);if(4===i.length){if(!(0<=t&&t<=4095))return e;e[0]=(3840&t)>>4|(3840&t)>>8,e[1]=240&t|(240&t)>>4,e[2]=15&t|(15&t)<<4}else if(7===i.length){if(!(0<=t&&t<=16777215))return e;e[0]=(16711680&t)>>16,e[1]=(65280&t)>>8,e[2]=255&t}}else{var t=i.indexOf("("),a=i.indexOf(")");if(-1!==t&&a+1===i.length){var r=i.substring(0,t);const s=i.substring(t+1,a).split(",");var n;switch(r){case"rgba":4===s.length&&(n=Y(255*parseFloat(s.pop())),e[3]=n);case"rgb":3===s.length&&(e[0]=Y(parseInt(s[0])),e[1]=Y(parseInt(s[1])),e[2]=Y(parseInt(s[2])))}}}return e}(l.backgroundColor)),i=a.header.gctList.length-1,a.header.bgIndex=a.header.gctList.length,a.header.gctList.push([e[0],e[1],e[2]]),a.header.gctList=V(a.header.gctList),a.header.gctSize=a.header.gctList.length,a.appExt&&(a.appExt.repetitionTimes=l.repetition),a.frames.forEach((t,e)=>{var e=l.frames[e];t.startByte=0,t.endByte=0,t.width=e.imageData.width,t.height=e.imageData.height,t.left=(a.header.width-t.width)/2>>0,t.top=(a.header.height-t.height)/2>>0,t.disposalMethod=e.disposalMethod||1,t.userInputFlag=!1,t.transColorFlag=!0,t.delay=null!=(e=e.delay)?e:10,t.lctList=t.lctList||[],t.lctFlag=!!t.lctList.length,t.interlace=!1,t.sortFlag=!1,t.transColorIdx=t.lctFlag?t.lctList.length-1:i,t.lctList=t.lctFlag?V(t.lctList):[],t.lctSize=t.lctList.length,t.codeSize=u(t.lctSize),t.imageStartByte=0,t.imageEndByte=0});const s=yield v({action:"replaceRepetedIndices",param:[a]});return new Promise(i=>{Promise.all([I(a),I(s)]).then(t=>{var e=t[0],t=t[1];e.length<t.length?i(e):i(t)})})})}function V(e){let t=u(e.length);t<4&&(t=4);var i=Math.pow(2,t);for(let t=0;t<i;t++)e[t]||(e[t]=[0,0,0]);return e}var X={decode(t,e){return s(this,void 0,void 0,function*(){return w(t,t=>null==e?void 0:e(t))})},encode(t){return s(this,void 0,void 0,function*(){return I(t)})},build(t){return s(this,void 0,void 0,function*(){return _(t)})},getFrameImageData:W,getFramesImageData(i){return i.frames.map((t,e)=>W(i,e))},getCompositeFrameImageData:C,getCompositeFramesImageData(i){return i.frames.map((t,e)=>C(i,e))}};class F{constructor(t){this.speedList=i,this._imgEl=null,this._canvas=null,this._ctx=null,this._offscreenCanvas=null,this._offscreenCtx=null,this._gifBuffer=null,this.gifData=null,this._currFrame=-1,this._nextUpdateTime=performance.now(),this._rAFCallbackQueue=[],this.isLoading=!1,this.isPlaying=!1,this.isRendering=!1,this._config=Object.assign(Object.assign({},e),t),i.includes(this._config.speed)||(this._config.speed=1),this._update=this._update.bind(this),this._renderFrame=this._renderFrame.bind(this),this._togglePlay=this._togglePlay.bind(this),this._init()}_init(){if(this._config.el){if(this._config.el instanceof HTMLImageElement&&(this._imgEl=this._config.el),"string"==typeof this._config.el){var t=document.querySelector(this._config.el);if(!t)return void this._errCall(g.noImg+this._config.el,"onError");if(!(t instanceof HTMLImageElement))return void this._errCall(g.notImg(this._config.el),"onError");this._imgEl=t}setTimeout(()=>{var t;this._initCanvas(),this._initContainer(),(t=this)._config.interactive&&"basic"===t._config.skin&&new z(t),!0===this._config.auto&&this.play(),this._rAFCallbackQueue.push(this._update),K(this._rAFCallbackQueue)})}else this._errCall(g.noConfigEl,"onError")}_initCanvas(){var t;const e=this._imgEl;var i=e.getBoundingClientRect();console.log(i),this._config.width="number"==typeof this._config.width?this._config.width:null!=(t=null==i?void 0:i.width)?t:0,this._config.height="number"==typeof this._config.height?this._config.height:null!=(t=null==i?void 0:i.height)?t:0,this._canvas=document.createElement("canvas"),this._canvas.style.cursor="pointer",this._canvas.addEventListener("click",this._togglePlay),this._canvas.width=this._config.width,this._canvas.height=this._config.height,this._canvas.style.width=this._config.width+"px",this._canvas.style.height=this._config.height+"px",this._ctx=this._canvas.getContext("2d"),this._ctx.globalCompositeOperation="copy",null!=(t=this._ctx)&&t.drawImage(e,0,0,null!=(t=null==i?void 0:i.width)?t:this._config.width,null!=(t=null==i?void 0:i.height)?t:this._config.height,0,0,null!=(t=this._config.width)?t:null==i?void 0:i.width,null!=(t=this._config.height)?t:null==i?void 0:i.height)}_initContainer(){var t,e=this._imgEl;const i=document.createElement("div");e.id&&(i.id=e.id),i.style.width=this._config.width+"px",i.style.height=this._config.height+"px",i.style.position="relative",i.style.display="inline-block",this._canvas&&(i.appendChild(this._canvas),null!=(t=e.parentElement)&&t.replaceChild(i,e))}play(){var e;return s(this,void 0,void 0,function*(){if(null===this._gifBuffer){if(!this._config.src&&"function"!=typeof this._config.httpRequest)return this._errCall(g.noGifUrl,"onError");yield this._getGif().catch(t=>this._errCall(t.message,"onLoadError"))}if(null!==this._gifBuffer){if(null===this.gifData){var t=yield w(this._gifBuffer,this._errCall);if(!t||!t.header.isGif)return;this.gifData=t,this._offscreenCanvas=document.createElement("canvas"),this._offscreenCanvas.width=null==(e=this.gifData)?void 0:e.header.width,this._offscreenCanvas.height=null==(e=this.gifData)?void 0:e.header.height,this._offscreenCtx=this._offscreenCanvas.getContext("2d")}if(c(this._config.onBeforePlay))if(!(yield this._config.onBeforePlay()))return;this.isPlaying=!0,this._nextUpdateTime=Math.max(this._nextUpdateTime,performance.now()),this._checkEnd()&&(this._currFrame=-1),c(this._config.onPlay)&&this._config.onPlay()}})}pause(){return s(this,void 0,void 0,function*(){if(c(this._config.onBeforePause)&&!(yield this._config.onBeforePause()))return;this.isPlaying=!1,c(this._config.onPause)&&this._config.onPause()})}nextFrame(){return this.gifData&&this._ctx&&this._offscreenCtx?this.isRendering?g.isRendering:(this._currFrame=(this._currFrame+1)%this.gifData.frames.length,this._renderFrame(),void(this._nextUpdateTime=performance.now()+this.gifData.frames[this._currFrame].delay/this._config.speed)):this._errCall(g.notReady,"onError")}prevFrame(){return this.gifData&&this._ctx&&this._offscreenCtx?this.isRendering?g.isRendering:(this._currFrame--,this._currFrame<0&&(this._currFrame=this.gifData.frames.length-1),this._renderFrame(),void(this._nextUpdateTime=performance.now()+this.gifData.frames[this._currFrame].delay/this._config.speed)):this._errCall(g.notReady,"onError")}jump(t){return this.gifData?"number"!=typeof t?this._errCall(g.wrongParam,"onError"):this.isRendering?g.isRendering:((t<0||t>this.gifData.frames.length-1)&&(t=0),this._currFrame=t,void this._renderFrame()):this._errCall(g.notReady,"onError")}setSpeed(t){return!!this.speedList.includes(t)&&(this._config.speed=t,!0)}_togglePlay(){!1!==this._config.interactive&&(this.isPlaying?this.pause():this.play())}_update(t){if(this.isPlaying&&!this.isRendering&&this.gifData&&this._ctx&&this._offscreenCtx&&!document.hidden&&!(this._nextUpdateTime>t))if(this._currFrame++,this._checkEnd())this.isPlaying=!1,c(this._config.onEnd)&&this._config.onEnd();else for(this._renderFrame();this._nextUpdateTime<=t;)this._nextUpdateTime+=Math.max(this.gifData.frames[this._currFrame].delay/this._config.speed,1),this._nextUpdateTime<=t&&(this._currFrame++,this._checkEnd()&&(this.isPlaying=!1,c(this._config.onEnd)&&this._config.onEnd(),this._currFrame=this.gifData.frames.length-1,this._renderFrame()))}_renderFrame(){var t=this.gifData,i=this._ctx,a=this._offscreenCtx;this.isRendering=!0;{var r=this._currFrame,n=t=>c(this._config.filter)?this._config.filter(t):t;let e=C(t,r);if(c(n)){let t=new ImageData(e.width,e.height);t.data.set(e.data),t=n(t),e=t}a.putImageData(e,0,0),i.drawImage(a.canvas,0,0,e.width,e.height,0,0,i.canvas.width,i.canvas.height),e}this.isRendering=!1}_checkEnd(){return this._currFrame>this.gifData.frames.length-1&&(!1===this._config.loop||(this._currFrame=0,!1))}_getGif(){return s(this,void 0,void 0,function*(){if(this.isLoading=!0,c(this._config.httpRequest))try{const t=yield this._config.httpRequest(this._config.src);this._gifBuffer=yield t.arrayBuffer()}catch(t){this._errCall(null==t?void 0:t.message,"onLoadError")}else try{const e=yield fetch(this._config.src);this._gifBuffer=yield e.arrayBuffer(),c(this._config.onLoad)&&this._config.onLoad()}catch(t){this._errCall(null==t?void 0:t.message,"onLoadError")}this.isLoading=!1})}_errCall(t,e){var i;if(c(this._config[e]))null!=(e=(i=this._config)[e])&&e.call(i,t);else{if(!c(this._config.onError))throw new Error(t);null!=(i=(e=this._config).onError)&&i.call(e,t)}}}return F.filter={grayscale:function(i){for(let t=0,e=i.data.length;t<e;t+=4){var a=.3*i.data[t]+.59*i.data[t+1]+.11*i.data[t+2]>>0;i.data[t]=i.data[t+1]=i.data[t+2]=a}return i},blackAndWhite:function(i){for(let t=0,e=i.data.length;t<e;t+=4){var a=(i.data[t]+i.data[t+1]+i.data[t+2])/3;i.data[t]=i.data[t+1]=i.data[t+2]=100<=a?255:0}return i},reverse:function(i){for(let t=0,e=i.data.length;t<e;t+=4)i.data[t]=255-i.data[t],i.data[t+1]=255-i.data[t+1],i.data[t+2]=255-i.data[t+2];return i},decolorizing:function(i){for(let t=0,e=i.data.length;t<e;t+=4){var a=(Math.min(i.data[t],i.data[t+1],i.data[t+2])+Math.max(i.data[t],i.data[t+1],i.data[t+2]))/2>>0;i.data[t]=i.data[t+1]=i.data[t+2]=a}return i},monochromeRed:function(i){for(let t=0,e=i.data.length;t<e;t+=4)i.data[t+1]=i.data[t+2]=0;return i},monochromeGreen:function(i){for(let t=0,e=i.data.length;t<e;t+=4)i.data[t]=i.data[t+2]=0;return i},monochromeBlue:function(i){for(let t=0,e=i.data.length;t<e;t+=4)i.data[t]=i.data[t+1]=0;return i},nostalgic:function(i){for(let t=0,e=i.data.length;t<e;t+=4){var a=i.data[t],r=i.data[t+1],n=i.data[t+2],s=.349*a+.686*r+.168*n,l=.272*a+.534*r+.131*n;i.data[t]=Math.min(255,Math.max(0,.393*a+.769*r+.189*n)),i.data[t+1]=Math.min(255,Math.max(0,s)),i.data[t+2]=Math.min(255,Math.max(0,l))}return i},cast:function(i){for(let t=0,e=i.data.length;t<e;t+=4){var a=i.data[t],r=i.data[t+1],n=i.data[t+2],s=128*r/(a+n+1),l=128*n/(r+a+1);i.data[t]=Math.min(255,Math.max(0,128*a/(r+n+1))),i.data[t+1]=Math.min(255,Math.max(0,s)),i.data[t+2]=Math.min(255,Math.max(0,l))}return i},frozen:function(i){for(let t=0,e=i.data.length;t<e;t+=4){var a=i.data[t],r=i.data[t+1],n=i.data[t+2],s=3*(r-a-n)/2,l=3*(n-r-a)/2;i.data[t]=Math.min(255,Math.max(0,3*(a-r-n)/2)),i.data[t+1]=Math.min(255,Math.max(0,s)),i.data[t+2]=Math.min(255,Math.max(0,l))}return i},comic:function(i){for(let t=0,e=i.data.length;t<e;t+=4){var a=i.data[t],r=i.data[t+1],n=i.data[t+2];i.data[t]=Math.abs(r-n+r+a)*a/256,i.data[t+1]=Math.abs(n-r+n+a)*a/256,i.data[t+2]=Math.abs(n-r+n+a)*r/256}return i},brown:function(i){for(let t=0,e=i.data.length;t<e;t+=4){var a=i.data[t],r=i.data[t+1],n=i.data[t+2],s=.349*a+.686*r+.168*n,l=.272*a+.534*r+.131*n;i.data[t]=Math.min(255,Math.max(0,.393*a+.769*r+.189*n)),i.data[t+1]=Math.min(255,Math.max(0,s)),i.data[t+2]=Math.min(255,Math.max(0,l))}return i},boxBlur:function(i,a=5){const r=new ImageData(i.width,i.height);var n,s;r.data.set(i.data),a=a%2?a:a+1;let l=new Uint8ClampedArray(a*a),o=0,d=0;for(let e=0,t=i.data.length;e<t;e+=4){n=e/4%i.width,s=e/4/i.width>>0;for(let t=0;t<3;t++){l=function(i,a,r,n,s,l,o){let d=!1,h=!1;var c,g,u=[s/2>>0,l/2>>0];let f=0;for(let e=0;e<s;e++)for(let t=0;t<l;t++)d=!1,h=!1,0<(c=u[0]-e)?a<c&&(d=!0):a-c>=i.width&&(d=!0),g=u[1]-t,t<u[1]?r<g&&(h=!0):r-g>=i.height&&(h=!0),d&&h?f=0<c&&0<g?0:c<0&&g<0?4*(i.width*i.height-1):0<c?i.width*(i.height-1)*4:4*(i.width-1):d?f=c<0?(r-g)*i.width*4:4*((r-g)*i.width-1):h&&(f=g<0?4*(a-c):4*((i.height-1)*i.width+a-c)),f=4*((r-g)*i.width+(a-c)),n[e+s*t]=i.data[f+o];return n}(i,n,s,l,a,a,t);for(let t=o=0,e=l.length;t<e;t++)o+=l[t];(d=o/l.length>>0)<0?d=0:255<d&&(d=255),r.data[e+t]=d}}return r}},F.gifKit=X,F});
