!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).AMZGif=e()}(this,function(){"use strict";function a(t,s,h,o){return new(h=h||Promise)(function(i,e){function a(t){try{n(o.next(t))}catch(t){e(t)}}function r(t){try{n(o.throw(t))}catch(t){e(t)}}function n(t){var e;t.done?i(t.value):((e=t.value)instanceof h?e:new h(function(t){t(e)})).then(a,r)}n((o=o.apply(t,s||[])).next())})}function o(t){return"function"==typeof t}const l={notReady:"数据未就绪",wrongParam:"参数错误",noGifUrl:"未指定 gif 图片地址",gifEmpty:"gif 不存在",gifDataTypeError:"gif 数据类型错误",notGif:"文件非 gif",noConfigEl:"未指定 img 元素",noImg:"未找到 img 元素",notImg:t=>`元素 ${t} 不是图片`,isRendering:"isRendering",skinError:"皮肤出错",skinContainerIsSmall:"空间不足以显示皮肤",errData:"数据格式错误"};function c(t){let e=1;for(;t>2**e;)e++;return e}function y(t,e,i){return t>>e&(1<<i)-1}function m(t,e,i,a){return((1<<i)-1&a)<<e|t}const e={loop:!0,auto:!1,interactive:!0,skin:"basic",speed:1},i=[.5,1,1.5,2],u=[0,0,0,255],p={decode:(t,e)=>{function i(){return new Array(2**t+2).fill(0).map((t,e)=>String.fromCharCode(e))}let a=i();var r=2**t,n=2**t+1;let s=t+1,h="",o=!0;var l=e.length;let g=0,d=0,f=s,c=0,u="",p=0;for(;g<l;){for(f=s,c=0;0!==f&&(8-d>=f?(c+=y(e[g],d,f)<<s-f,d+=f,f=0):(c+=y(e[g],d,8-d)<<s-f,f-=8-d,d=8),!(8===d&&(g++,d=0,g>=l))););if(c===n)break;c===r?(a=i(),s=t+1,o=!0):(void 0!==a[c]?o?(h+=a[c],p=c,o=!1):(h+=a[c],u=a[c][0],a.push(a[p]+u),p=c):(void 0===a[p]&&console.log(p,h.length),u=a[p][0],h+=a[p]+u,a.push(a[p]+u),p=c),a.length>=2**s&&s<12&&s++)}let m=new Uint8Array(h.length);for(let t=0;t<h.length;t++)m[t]=h.charCodeAt(t);return m},encode:(a,i)=>{function r(){const i=new Map;return new Array(2**a).fill(0).map((t,e)=>{i.set(String.fromCharCode(e),e)}),i}function n(t){let e=l;if(f+2>=d.length){const i=new Uint8Array(d.length+256);i.set(d),d=i}for(;e;)8-c>=e?(d[f]=m(d[f],c,e,t),c+=e,e=0):(d[f]=m(d[f],c,8-c,t),t>>=8-c,e-=8-c,c=8),8===c&&(c=0,f++)}let s=r();var h=2**a,t=2**a+1;let o=2**a+2,l=a+1,g=2**l;let d=new Uint8Array(256),f=0,c=0,u="",p="";n(h);for(let t=0,e=i.length;t<e;t++)p=String.fromCharCode(i[t]),s.has(u+p)?u+=p:(n(s.get(u)),4093===o?(n(h),s=r(),o=2**a+2,l=a+1,g=2**l):(o===g&&(l++,g=2**l),s.set(u+p,o++)),u=p,p="");u&&n(s.get(u)),n(t);let e=null;return e=c?d.slice(0,f+1):d.slice(0,f)}};function r(t,e){if(!(t instanceof ArrayBuffer)){if(o(e))return e(l.gifDataTypeError,"onDataError");throw new Error(l.gifDataTypeError)}var i=new Uint8Array(t);const a={ptr:0},r={header:{type:"",isGif:!1,version:"",width:0,height:0,gctFlag:!1,cr:0,sortFlag:!1,gctSize:0,gctStartByte:0,gctEndByte:0,bgIndex:0,pixelAspect:0,gctList:[]},frames:[]};for(;a.ptr<i.length;){if(0===a.ptr){var n=function(e,t){const i={type:"",isGif:!1,version:""};for(let t=0;t<3;t++)i.type+=String.fromCharCode(e[t]);if(i.isGif=i.type==="GIF",i.isGif){for(let t=3;t<6;t++)i.version+=String.fromCharCode(e[t]);t.ptr=5}return i}(i,a);if(!n.isGif)return e(l.notGif,"onDataError");Object.assign(r.header,n)}else if(6===a.ptr){var n=function(t,e){const i={width:0,height:0,gctFlag:!1,cr:0,sortFlag:!1,gctSize:0,gctStartByte:0,gctEndByte:0,bgIndex:0,pixelAspect:0};i.width=t[6]+(t[7]<<8),i.height=t[8]+(t[9]<<8),i.gctFlag=Boolean(t[10]>>7),i.cr=t[10]>>4&7,i.sortFlag=Boolean(8&t[10]),i.gctSize=Math.pow(2,1+(7&t[10])),i.gctFlag&&(i.gctStartByte=13,i.gctEndByte=13+3*i.gctSize-1);return i.bgIndex=t[11],i.pixelAspect=t[12],e.ptr=12,i}(i,a),s=(Object.assign(r.header,n),n.gctFlag?(++a.ptr,function(e,t,i){const a=3*t,r=13+a,n=[];for(let t=13;t<r;t+=3)n.push([e[t],e[t+1],e[t+2]]);return i.ptr=r-1,n}(i,n.gctSize,a)):[]);r.header.gctList=s}else if(a.ptr+1<i.length&&33===i[a.ptr]&&255===i[a.ptr+1]&&!r.appExt){s=function(e,t){const i={appName:"",verification:"",blockIdx:1,repetitionTimes:0,startByte:0,endByte:0};i.startByte=t.ptr;let a=i.startByte;var r=e[a+=2];a++;for(let t=0;t<r-3;t++)i.appName+=String.fromCharCode(e[a+t]);a+=r-3;for(let t=0;t<3;t++)i.verification+=String.fromCharCode(e[a+t]);a+=3;var n=e[a];return i.endByte=a+n,i.blockIdx=e[a+1],i.repetitionTimes=e[a+2]+(e[a+3]<<8),t.ptr=i.endByte,i}(i,a);r.appExt=s}else if(a.ptr+1<i.length&&33===i[a.ptr]&&249===i[a.ptr+1])r.frames.push(g(i,a));else if(44===i[a.ptr]){let t=g(i,a);var h=r.frames[r.frames.length-1];h.endByte?r.frames.push(t):(t.startByte=h.startByte,t.disposalMethod=h.disposalMethod,t.userInputFlag=h.userInputFlag,t.transColorFlag=h.transColorFlag,t.delay=h.delay,t.transColorIdx=h.transColorIdx,r.frames[r.frames.length-1]=t)}else if(a.ptr+1<i.length&&33===i[a.ptr]&&1===i[a.ptr+1])r.frames.push(g(i,a));else if(59===i[a.ptr])break;a.ptr++}return console.log(r),r}function g(a,t){const r={startByte:t.ptr,endByte:0,width:0,height:0,left:0,top:0,disposalMethod:0,userInputFlag:!1,transColorFlag:!1,delay:0,transColorIdx:0,lctFlag:!1,interlace:!1,sortFlag:!1,lctSize:0,lctStartByte:0,lctEndByte:0,lctList:[],imageData:new Uint8Array,imageStartByte:0,imageEndByte:0};if(33===a[t.ptr]&&249===a[t.ptr+1]&&(t.ptr+=2,n=a[t.ptr],n=t.ptr+n+1,t.ptr++,r.disposalMethod=(28&a[t.ptr])>>2,r.userInputFlag=Boolean((2&a[t.ptr])>>1),r.transColorFlag=Boolean(1&a[t.ptr]),r.delay=10*(a[++t.ptr]+(a[++t.ptr]<<8)),r.transColorIdx=a[++t.ptr],(0!==a[++t.ptr]||t.ptr>n)&&(t.ptr=n)),44===a[t.ptr]){if(r.left=a[++t.ptr]+(a[++t.ptr]<<8),r.top=a[++t.ptr]+(a[++t.ptr]<<8),r.width=a[++t.ptr]+(a[++t.ptr]<<8),r.height=a[++t.ptr]+(a[++t.ptr]<<8),r.lctFlag=Boolean(128&a[++t.ptr]),r.interlace=Boolean(64&a[t.ptr]),r.sortFlag=Boolean(32&a[t.ptr]),r.lctSize=Math.pow(2,1+(7&a[t.ptr])),r.lctFlag){r.lctStartByte=t.ptr+1,r.lctEndByte=t.ptr+3*r.lctSize;for(let t=r.lctStartByte;t<r.lctEndByte;t+=3)r.lctList.push([a[t],a[t+1],a[t+2]]);t.ptr=r.lctEndByte}t.ptr++,r.imageStartByte=t.ptr;var n=a[t.ptr++];const o=[];let e=0;for(;0!==a[t.ptr]&&void 0!==a[t.ptr];){var s=a[t.ptr++],h=a.slice(t.ptr,t.ptr+s);e+=h.length,o.push(h),t.ptr+=s}r.imageEndByte=t.ptr,r.endByte=t.ptr;let i=new Uint8Array(e);for(let t=o.length-1;0<=t;t--)i.set(o[t],e-=o[t].length);r.imageData=p.decode(n,i)}return r}function n(i){var t=performance.now();let a=0,r=t;a=window.requestAnimationFrame(function t(e){1e3/60<=e-r&&(r=e-(e-r)%(1e3/60),i.map(t=>{t(e)})),a=window.requestAnimationFrame(t)})}function _(t,i){const a=t.frames[i];if(a.canvasImageData instanceof ImageData)return a.canvasImageData;var r=function t(i,e){if(e<=0)return;const a=i.frames[e-1];if(0===a.disposalMethod)return;if(2===a.disposalMethod){const r=i.header.gctFlag?[...i.header.gctList[i.header.bgIndex],255]:[...u];let t=a.canvasImageData;t=t||_(i,e-1);const n=new ImageData(t.width,t.height);n.data.set(t.data);for(let e=a.top;e<a.top+a.height;e++)for(let t=a.left;t<a.left+a.width;t++){const s=e*i.header.width+t<<2;n.data[s]=r[0],n.data[1+s]=r[1],n.data[2+s]=r[2],n.data[3+s]=r[3]}return n}if([1].includes(a.disposalMethod))return a.canvasImageData||_(i,e-1);if(3===a.disposalMethod)return t(i,e-1);return}(t,i),n=a.lctFlag?a.lctList:t.header.gctList,s=t.header.gctFlag?[...t.header.gctList[t.header.bgIndex],255]:[...u],h=t.header.width,i=t.header.height,o=b(a);const l=new Uint8ClampedArray(h*i*4);for(let t=0,e=h*i;t<e;t++){var g=t%h,d=t/h>>0,f=t<<2;g>=a.left&&g<a.left+a.width&&d>=a.top&&d<a.top+a.height?(g=g-a.left+(d-a.top)*a.width,a.transColorFlag&&o[g]===a.transColorIdx?r&&(l[f]=r.data[f],l[1+f]=r.data[1+f],l[2+f]=r.data[2+f],l[3+f]=r.data[3+f]):(d=n[o[g]],l[f]=d[0],l[1+f]=d[1],l[2+f]=d[2],l[3+f]=255)):r?(l[f]=r.data[f],l[1+f]=r.data[1+f],l[2+f]=r.data[2+f],l[3+f]=r.data[3+f]):(l[f]=s[0],l[1+f]=s[1],l[2+f]=s[2],l[3+f]=s[3])}t=new ImageData(l,h,i);return a.canvasImageData=t}function s(t,e){const i=t.frames[e];if(i.independentImageData instanceof ImageData)return i.independentImageData;var a=i.lctFlag?i.lctList:t.header.gctList,r=b(i);const n=new Uint8ClampedArray(i.width*i.height*4);for(let t=0;t<i.imageData.length;t++){var s,h=t<<2;i.transColorFlag&&r[t]===i.transColorIdx?(n[h]=0,n[1+h]=0,n[2+h]=0,n[3+h]=0):(s=a[r[t]],n[h]=s[0],n[1+h]=s[1],n[2+h]=s[2],n[3+h]=255)}const o=new ImageData(i.width,i.height);return o.data.set(n),i.independentImageData=o}function b(a){const r=new Uint8Array(a.imageData.length);if(a.interlace){let e=0,i=0;function t(){for(let t=0;t<a.width;t++)r[i]=a.imageData[e*a.width+t],i++}for(;e<a.height;)t(),e+=8;for(e=4;e<a.height;)t(),e+=8;for(e=2;e<a.height;)t(),e+=4;for(e=1;e<a.height;)t(),e+=2}else r.set(a.imageData);return r}class h extends class{constructor(t){this.keys=[],this.watch={},this.amzGif=t,this.cache={},this.init()}init(){this.dirtyChecking()}dirtyChecking(){const e=[];let i;Object.keys(this.watch).map(t=>{i=this.getValue(t),this.cache[t]!==i&&e.push({key:t,oldValue:this.cache[t],newValue:i})}),e.map(t=>a(this,void 0,void 0,function*(){o(this.watch[t.key])&&(yield this.watch[t.key](t.newValue,t.oldValue))}))}getValue(t){var e=t.split(".").filter(t=>t);let i=this.amzGif;for(let t=0;t<e.length&&void 0!==(i=null===i||void 0===i?void 0:i[e[t]]);t++);return i}}{constructor(t){super(t),this.playDiv=null,this.playImg=null,this.loadingDiv=null,this.loadingImg=null,this.loadingImgRoate=0,this.handlePlay=this.handlePlay.bind(this),this.dirtyChecking=this.dirtyChecking.bind(this),this.init(),this.setWatch()}init(){const t=this.amzGif._canvas.parentElement;if(t){var e=t.getBoundingClientRect();const i=this.genMask(e.width,e.height),a=(i.style.zIndex="1",i.style.display="none",i.style.cursor="pointer",i.addEventListener("click",this.handlePlay.bind(this)),this.playDiv=i,document.createElement("img")),r=(a.src="data:image/svg+xml;base64,PHN2ZyB0PSIxNjYyNzg5NjY0NjUyIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIzNjciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48cGF0aCBkPSJNMTI4IDEzOC42NjY2NjdjMC00Ny4yMzIgMzMuMzIyNjY3LTY2LjY2NjY2NyA3NC4xNzYtNDMuNTYyNjY3bDY2My4xNDY2NjcgMzc0Ljk1NDY2N2M0MC45NiAyMy4xNjggNDAuODUzMzMzIDYwLjggMCA4My44ODI2NjZMMjAyLjE3NiA5MjguODk2QzE2MS4yMTYgOTUyLjA2NCAxMjggOTMyLjU2NTMzMyAxMjggODg1LjMzMzMzM3YtNzQ2LjY2NjY2NnoiIGZpbGw9IiMzRDNEM0QiIHAtaWQ9IjIzNjgiPjwvcGF0aD48L3N2Zz4=",a.style.width="60px",a.style.height="60px",a.style.opacity="0.6",this.playImg=a,i.appendChild(a),t.appendChild(i),this.genMask(e.width,e.height)),n=((this.loadingDiv=r).style.zIndex="2",r.style.display="none",document.createElement("img"));(this.loadingImg=n).src="data:image/svg+xml;base64,PHN2ZyB0PSIxNjYyNzg5NzI0Njc4IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM0NDEiIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48cGF0aCBkPSJNNTEyLjUxMSAyMS40ODNjLTI3MS4xNjMgMC00OTEuMDI4IDIxOS44Ni00OTEuMDI4IDQ5MS4wMjggMCAyNzEuMTczIDIxOS44NTYgNDkxLjAzIDQ5MS4wMjggNDkxLjAzIDI2LjU1NCAwIDQ4LjA4LTIxLjUyNyA0OC4wOC00OC4wOCAwLTI2LjU1NC0yMS41MjYtNDguMDgtNDguMDgtNDguMDgtMjE4LjA2NSAwLTM5NC44NjktMTc2LjgwNC0zOTQuODY5LTM5NC44NyAwLTIxOC4wNiAxNzYuODEzLTM5NC44NjkgMzk0Ljg3LTM5NC44NjkgMjE4LjA2NSAwIDM5NC44NjkgMTc2LjgwNCAzOTQuODY5IDM5NC44NyAwIDI2LjU1MyAyMS41MjYgNDguMDggNDguMDggNDguMDggMjYuNTUzIDAgNDguMDgtMjEuNTI3IDQ4LjA4LTQ4LjA4IDAtMjcxLjE3My0yMTkuODU3LTQ5MS4wMy00OTEuMDMtNDkxLjAzeiIgcC1pZD0iMzQ0MiI+PC9wYXRoPjwvc3ZnPg==",n.style.width="60px",n.style.height="60px",n.style.opacity="0.6",r.appendChild(n),t.appendChild(r),this.amzGif._rAFCallbackQueue.push(this.dirtyChecking.bind(this))}else this.amzGif._errCall(l.skinError,"onError")}genMask(t,e){const i=document.createElement("div");return i.style.backgroundColor="rgba(0, 0, 0, 0.3)",i.style.width=t+"px",i.style.height=e+"px",i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.display="flex",i.style.justifyContent="center",i.style.alignItems="center",i}setWatch(){this.watch.isPlaying=t=>{this.playDiv&&(this.playDiv.style.display=t||this.amzGif.isLoading?"none":"flex")},this.watch.isLoading=t=>{this.loadingDiv&&(this.loadingDiv.style.display=t?"flex":"none",t&&this.loadingImg&&(this.loadingImg.style.transform=`rotate(${this.loadingImgRoate+=1}deg)`))}}handlePlay(){this.amzGif.isPlaying||this.amzGif.play()}}function d(t){let e={buf:M(new Uint8Array(0)),ptr:0};var i,a;if(a=e,i=t.header,a.buf[0]=i.type.charCodeAt(0),a.buf[1]=i.type.charCodeAt(1),a.buf[2]=i.type.charCodeAt(2),a.buf[3]=i.version.charCodeAt(0),a.buf[4]=i.version.charCodeAt(1),a.buf[5]=i.version.charCodeAt(2),a.ptr=6,i=e,a=t.header,i.buf[6]=255&a.width,i.buf[7]=a.width>>8,i.buf[8]=255&a.height,i.buf[9]=a.height>>8,i.buf[10]=m(i.buf[10],7,1,Number(a.gctFlag)),i.buf[10]=m(i.buf[10],4,3,a.cr-1),i.buf[10]=m(i.buf[10],3,1,Number(a.sortFlag)),i.buf[10]=m(i.buf[10],0,3,c(a.gctSize)-1),i.buf[11]=a.bgIndex,i.buf[12]=a.pixelAspect,i.ptr=13,t.header.gctFlag&&v(e,t.header.gctList),t.appExt){var r=e,n=t.appExt;r.ptr+18>=r.buf.length&&(r.buf=M(r.buf)),r.buf[r.ptr++]=33,r.buf[r.ptr++]=255,r.buf[r.ptr++]=n.appName.length+n.verification.length;for(let t=0,e=n.appName.length;t<e;t++)r.buf[r.ptr++]=n.appName.charCodeAt(t);for(let t=0,e=n.verification.length;t<e;t++)r.buf[r.ptr++]=n.verification.charCodeAt(t);r.buf[r.ptr++]=3,r.buf[r.ptr++]=n.blockIdx,r.buf[r.ptr++]=255&n.repetitionTimes,r.buf[r.ptr++]=n.repetitionTimes>>8,r.buf[r.ptr++]=0}var s=e,h=t.frames,o=t.header.gctSize;for(let t=0,e=h.length;t<e;t++){for(var l=h[t],g=(!function(t,e){t.ptr+8>=t.buf.length&&(t.buf=M(t.buf));t.buf[t.ptr++]=33,t.buf[t.ptr++]=249,t.buf[t.ptr++]=4,t.buf[t.ptr]=m(t.buf[t.ptr],2,3,e.disposalMethod),t.buf[t.ptr]=m(t.buf[t.ptr],1,1,Number(e.userInputFlag)),t.buf[t.ptr]=m(t.buf[t.ptr],0,1,Number(e.transColorFlag)),t.ptr++,t.buf[t.ptr++]=e.delay/10&255,t.buf[t.ptr++]=e.delay/10>>8,t.buf[t.ptr++]=e.transColorIdx,t.buf[t.ptr++]=0}(s,l),!function(t,e){t.ptr+10>=t.buf.length&&(t.buf=M(t.buf));t.buf[t.ptr++]=44,t.buf[t.ptr++]=255&e.left,t.buf[t.ptr++]=e.left>>8,t.buf[t.ptr++]=255&e.top,t.buf[t.ptr++]=e.top>>8,t.buf[t.ptr++]=255&e.width,t.buf[t.ptr++]=e.width>>8,t.buf[t.ptr++]=255&e.height,t.buf[t.ptr++]=e.height>>8,t.buf[t.ptr]=m(t.buf[t.ptr],7,1,Number(e.lctFlag)),t.buf[t.ptr]=m(t.buf[t.ptr],6,1,Number(e.interlace)),t.buf[t.ptr]=m(t.buf[t.ptr],2,1,Number(e.sortFlag)),t.buf[t.ptr]=m(t.buf[t.ptr],0,3,c(e.lctSize)-1),t.ptr++}(s,l),l.lctFlag&&v(s,l.lctList),l.lctFlag?c(l.lctSize):c(o)),d=p.encode(g,l.imageData),f=d.length+Math.ceil(d.length/255);s.ptr+1+f>=s.buf.length;)s.buf=M(s.buf);s.buf[s.ptr++]=g;let i=s.ptr;for(let t=0,e=d.length;t<e;t++)i===s.ptr&&s.ptr++,s.buf[s.ptr]=d[t],s.ptr-i!=255&&t+1!==e||(s.buf[i]=s.ptr-i,i=s.ptr+1),s.ptr++;s.buf[s.ptr++]=0}return e.ptr>=e.buf.length&&(e.buf=M(e.buf)),e.buf[e.ptr]=59,e.ptr++,e.buf.slice(0,e.ptr)}function v(i,a){for(let t=0,e=a.length;t<e;t++)i.ptr+3>=i.buf.length&&(i.buf=M(i.buf)),i.buf[i.ptr++]=a[t][0],i.buf[i.ptr++]=a[t][1],i.buf[i.ptr++]=a[t][2]}function M(t){var e=1048576;if(e=e||256,t instanceof Uint8Array){const i=new Uint8Array(t.length+e);return i.set(t),i}}var t={decode(t,i){return r(t,(t,e)=>i(t))},encode(t){return d(t)},getFrameImageData:s,getFramesImageData(i){return i.frames.map((t,e)=>s(i,e))},getCompositeFrameImageData:_,getCompositeFramesImageData(i){return i.frames.map((t,e)=>_(i,e))}};class f{constructor(t){this.speedList=i,this._imgEl=null,this._canvas=null,this._ctx=null,this._offscreenCanvas=null,this._offscreenCtx=null,this._gifBuffer=null,this.gifData=null,this._currFrame=-1,this._nextUpdateTime=performance.now(),this._rAFCallbackQueue=[],this.isLoading=!1,this.isPlaying=!1,this.isRendering=!1,this._config=Object.assign(Object.assign({},e),t),i.includes(this._config.speed)||(this._config.speed=1),this._update=this._update.bind(this),this._renderFrame=this._renderFrame.bind(this),this._togglePlay=this._togglePlay.bind(this),this._init()}_init(){if(this._config.el){if(this._config.el instanceof HTMLImageElement&&(this._imgEl=this._config.el),"string"==typeof this._config.el){var t=document.querySelector(this._config.el);if(!t)return void this._errCall(l.noImg+this._config.el,"onError");if(!(t instanceof HTMLImageElement))return void this._errCall(l.notImg(this._config.el),"onError");this._imgEl=t}setTimeout(()=>{var t;this._initCanvas(),this._initContainer(),(t=this)._config.interactive&&"basic"===t._config.skin&&new h(t),!0===this._config.auto&&this.play(),this._rAFCallbackQueue.push(this._update),n(this._rAFCallbackQueue)})}else this._errCall(l.noConfigEl,"onError")}_initCanvas(){var t;const e=this._imgEl;var i=e.getBoundingClientRect();console.log(i),this._config.width="number"==typeof this._config.width?this._config.width:null!=(t=null==i?void 0:i.width)?t:0,this._config.height="number"==typeof this._config.height?this._config.height:null!=(t=null==i?void 0:i.height)?t:0,this._canvas=document.createElement("canvas"),this._canvas.style.cursor="pointer",this._canvas.addEventListener("click",this._togglePlay),this._canvas.width=this._config.width,this._canvas.height=this._config.height,this._canvas.style.width=this._config.width+"px",this._canvas.style.height=this._config.height+"px",this._ctx=this._canvas.getContext("2d"),this._ctx.globalCompositeOperation="copy",null!=(t=this._ctx)&&t.drawImage(e,0,0,null!=(t=null==i?void 0:i.width)?t:this._config.width,null!=(t=null==i?void 0:i.height)?t:this._config.height,0,0,null!=(t=this._config.width)?t:null==i?void 0:i.width,null!=(t=this._config.height)?t:null==i?void 0:i.height)}_initContainer(){var t,e=this._imgEl;const i=document.createElement("div");e.id&&(i.id=e.id),i.style.width=this._config.width+"px",i.style.height=this._config.height+"px",i.style.position="relative",i.style.display="inline-block",this._canvas&&(i.appendChild(this._canvas),null!=(t=e.parentElement)&&t.replaceChild(i,e))}play(){var e;return a(this,void 0,void 0,function*(){if(null===this._gifBuffer){if(!this._config.src&&"function"!=typeof this._config.httpRequest)return this._errCall(l.noGifUrl,"onError");yield this._getGif().catch(t=>this._errCall(t.message,"onLoadError"))}if(null!==this._gifBuffer){if(null===this.gifData){var t=r(this._gifBuffer,this._errCall);if(!t||!t.header.isGif)return;this.gifData=t,this._offscreenCanvas=document.createElement("canvas"),this._offscreenCanvas.width=null==(e=this.gifData)?void 0:e.header.width,this._offscreenCanvas.height=null==(e=this.gifData)?void 0:e.header.height,this._offscreenCtx=this._offscreenCanvas.getContext("2d")}if(o(this._config.onBeforePlay))if(!(yield this._config.onBeforePlay()))return;this.isPlaying=!0,this._nextUpdateTime=Math.max(this._nextUpdateTime,performance.now()),this._checkEnd()&&(this._currFrame=-1),o(this._config.onPlay)&&this._config.onPlay()}})}pause(){return a(this,void 0,void 0,function*(){if(o(this._config.onBeforePause)&&!(yield this._config.onBeforePause()))return;this.isPlaying=!1,o(this._config.onPause)&&this._config.onPause()})}nextFrame(){return this.gifData&&this._ctx&&this._offscreenCtx?this.isRendering?l.isRendering:(this._currFrame=(this._currFrame+1)%this.gifData.frames.length,this._renderFrame(),void(this._nextUpdateTime=performance.now()+this.gifData.frames[this._currFrame].delay/this._config.speed)):this._errCall(l.notReady,"onError")}prevFrame(){return this.gifData&&this._ctx&&this._offscreenCtx?this.isRendering?l.isRendering:(this._currFrame--,this._currFrame<0&&(this._currFrame=this.gifData.frames.length-1),this._renderFrame(),void(this._nextUpdateTime=performance.now()+this.gifData.frames[this._currFrame].delay/this._config.speed)):this._errCall(l.notReady,"onError")}jump(t){return this.gifData?"number"!=typeof t?this._errCall(l.wrongParam,"onError"):this.isRendering?l.isRendering:((t<0||t>this.gifData.frames.length-1)&&(t=0),this._currFrame=t,void this._renderFrame()):this._errCall(l.notReady,"onError")}setSpeed(t){return!!this.speedList.includes(t)&&(this._config.speed=t,!0)}_togglePlay(){!1!==this._config.interactive&&(this.isPlaying?this.pause():this.play())}_update(t){if(this.isPlaying&&!this.isRendering&&this.gifData&&this._ctx&&this._offscreenCtx&&!document.hidden&&!(this._nextUpdateTime>t))if(this._currFrame++,this._checkEnd())this.isPlaying=!1,o(this._config.onEnd)&&this._config.onEnd();else for(this._renderFrame();this._nextUpdateTime<=t;)this._nextUpdateTime+=Math.max(this.gifData.frames[this._currFrame].delay/this._config.speed,1),this._nextUpdateTime<=t&&(this._currFrame++,this._checkEnd()&&(this.isPlaying=!1,o(this._config.onEnd)&&this._config.onEnd(),this._currFrame=this.gifData.frames.length-1,this._renderFrame()))}_renderFrame(){var t=this.gifData,i=this._ctx,a=this._offscreenCtx;this.isRendering=!0;{var r=this._currFrame,n=t=>o(this._config.filter)?this._config.filter(t):t;let e=_(t,r);if(o(n)){let t=new ImageData(e.width,e.height);t.data.set(e.data),t=n(t),e=t}a.putImageData(e,0,0),i.drawImage(a.canvas,0,0,e.width,e.height,0,0,i.canvas.width,i.canvas.height),e}this.isRendering=!1}_checkEnd(){return this._currFrame>this.gifData.frames.length-1&&(!1===this._config.loop||(this._currFrame=0,!1))}_getGif(){return a(this,void 0,void 0,function*(){if(this.isLoading=!0,o(this._config.httpRequest))try{const t=yield this._config.httpRequest(this._config.src);this._gifBuffer=yield t.arrayBuffer()}catch(t){this._errCall(null==t?void 0:t.message,"onLoadError")}else try{const e=yield fetch(this._config.src);this._gifBuffer=yield e.arrayBuffer(),o(this._config.onLoad)&&this._config.onLoad()}catch(t){this._errCall(null==t?void 0:t.message,"onLoadError")}this.isLoading=!1})}_errCall(t,e){var i;if(o(this._config[e]))null!=(e=(i=this._config)[e])&&e.call(i,t);else{if(!o(this._config.onError))throw new Error(t);null!=(i=(e=this._config).onError)&&i.call(e,t)}}}return f.filter={grayscale:function(i){for(let t=0,e=i.data.length;t<e;t+=4){var a=.3*i.data[t]+.59*i.data[t+1]+.11*i.data[t+2]>>0;i.data[t]=i.data[t+1]=i.data[t+2]=a}return i},blackAndWhite:function(i){for(let t=0,e=i.data.length;t<e;t+=4){var a=(i.data[t]+i.data[t+1]+i.data[t+2])/3;i.data[t]=i.data[t+1]=i.data[t+2]=100<=a?255:0}return i},reverse:function(i){for(let t=0,e=i.data.length;t<e;t+=4)i.data[t]=255-i.data[t],i.data[t+1]=255-i.data[t+1],i.data[t+2]=255-i.data[t+2];return i},decolorizing:function(i){for(let t=0,e=i.data.length;t<e;t+=4){var a=(Math.min(i.data[t],i.data[t+1],i.data[t+2])+Math.max(i.data[t],i.data[t+1],i.data[t+2]))/2>>0;i.data[t]=i.data[t+1]=i.data[t+2]=a}return i},monochromeRed:function(i){for(let t=0,e=i.data.length;t<e;t+=4)i.data[t+1]=i.data[t+2]=0;return i},monochromeGreen:function(i){for(let t=0,e=i.data.length;t<e;t+=4)i.data[t]=i.data[t+2]=0;return i},monochromeBlue:function(i){for(let t=0,e=i.data.length;t<e;t+=4)i.data[t]=i.data[t+1]=0;return i},nostalgic:function(i){for(let t=0,e=i.data.length;t<e;t+=4){var a=i.data[t],r=i.data[t+1],n=i.data[t+2],s=.349*a+.686*r+.168*n,h=.272*a+.534*r+.131*n;i.data[t]=Math.min(255,Math.max(0,.393*a+.769*r+.189*n)),i.data[t+1]=Math.min(255,Math.max(0,s)),i.data[t+2]=Math.min(255,Math.max(0,h))}return i},cast:function(i){for(let t=0,e=i.data.length;t<e;t+=4){var a=i.data[t],r=i.data[t+1],n=i.data[t+2],s=128*r/(a+n+1),h=128*n/(r+a+1);i.data[t]=Math.min(255,Math.max(0,128*a/(r+n+1))),i.data[t+1]=Math.min(255,Math.max(0,s)),i.data[t+2]=Math.min(255,Math.max(0,h))}return i},frozen:function(i){for(let t=0,e=i.data.length;t<e;t+=4){var a=i.data[t],r=i.data[t+1],n=i.data[t+2],s=3*(r-a-n)/2,h=3*(n-r-a)/2;i.data[t]=Math.min(255,Math.max(0,3*(a-r-n)/2)),i.data[t+1]=Math.min(255,Math.max(0,s)),i.data[t+2]=Math.min(255,Math.max(0,h))}return i},comic:function(i){for(let t=0,e=i.data.length;t<e;t+=4){var a=i.data[t],r=i.data[t+1],n=i.data[t+2];i.data[t]=Math.abs(r-n+r+a)*a/256,i.data[t+1]=Math.abs(n-r+n+a)*a/256,i.data[t+2]=Math.abs(n-r+n+a)*r/256}return i},brown:function(i){for(let t=0,e=i.data.length;t<e;t+=4){var a=i.data[t],r=i.data[t+1],n=i.data[t+2],s=.349*a+.686*r+.168*n,h=.272*a+.534*r+.131*n;i.data[t]=Math.min(255,Math.max(0,.393*a+.769*r+.189*n)),i.data[t+1]=Math.min(255,Math.max(0,s)),i.data[t+2]=Math.min(255,Math.max(0,h))}return i},boxBlur:function(i,a=5){const r=new ImageData(i.width,i.height);var n,s;r.data.set(i.data),a=a%2?a:a+1;let h=new Uint8ClampedArray(a*a),o=0,l=0;for(let e=0,t=i.data.length;e<t;e+=4){n=e/4%i.width,s=e/4/i.width>>0;for(let t=0;t<3;t++){h=function(i,a,r,n,s,h,o){let l=!1,g=!1;var d,f,c=[s/2>>0,h/2>>0];let u=0;for(let e=0;e<s;e++)for(let t=0;t<h;t++)l=!1,g=!1,0<(d=c[0]-e)?a<d&&(l=!0):a-d>=i.width&&(l=!0),f=c[1]-t,t<c[1]?r<f&&(g=!0):r-f>=i.height&&(g=!0),l&&g?u=0<d&&0<f?0:d<0&&f<0?4*(i.width*i.height-1):0<d?i.width*(i.height-1)*4:4*(i.width-1):l?u=d<0?(r-f)*i.width*4:4*((r-f)*i.width-1):g&&(u=f<0?4*(a-d):4*((i.height-1)*i.width+a-d)),u=4*((r-f)*i.width+(a-d)),n[e+s*t]=i.data[u+o];return n}(i,n,s,h,a,a,t);for(let t=o=0,e=h.length;t<e;t++)o+=h[t];(l=o/h.length>>0)<0?l=0:255<l&&(l=255),r.data[e+t]=l}}return r}},f.gifKit=t,f});
